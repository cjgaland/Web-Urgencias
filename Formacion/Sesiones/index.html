<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>Sesiones clínicas – Histórico · Urgencias · AGS Sur de Córdoba</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
<style>
:root{--c1:#0a5ea8;--c1d:#0a4c84;--bd:#e1eefc;--bg:#f7fbff;--bx:#d1d9e6;--tx:#0a4c84}
*{box-sizing:border-box}
body{font-family:Roboto,Arial,sans-serif;margin:0;background:#fff;color:#0f172a}
.container{max-width:1100px;margin:auto;padding:16px}

/* Cabecera con logo centrado */
.hero-top{display:flex;flex-direction:column;align-items:center;gap:.4rem;margin:8px 0 12px}
.hero-top img{width:180px;height:auto;opacity:.95}
.hero-top h1{font-size:1.05rem;margin:4px 0 0;color:var(--tx);display:flex;align-items:center;gap:.5rem}
.hero-top h1 i{color:var(--c1)}

/* Herramientas */
.toolbar{display:flex;flex-direction:column;align-items:center;gap:.6rem;margin:.4rem 0 1rem}
input[type="search"]{width:min(720px,92%);border:1px solid var(--bx);border-radius:12px;padding:.6rem .8rem}
.filters{display:flex;flex-wrap:wrap;gap:.4rem;justify-content:center}
.chip{border:1px solid #e2e8f0;background:#f8fafc;color:#0f172a;border-radius:999px;padding:.25rem .6rem;cursor:pointer;font-size:.9rem}
.chip.active{background:var(--c1);border-color:transparent;color:#fff}
.note{margin:.2rem 0 1.1rem;text-align:center;color:#667085}

/* Tarjetas */
.card-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:12px}
.link-card{border:1px solid #e5e7eb;border-radius:12px;padding:12px;background:#fff;box-shadow:0 2px 8px rgba(0,0,0,.05)}
.link-card .title{font-weight:700;color:var(--c1d);margin:0 0 6px}
.meta{display:flex;gap:.6rem;flex-wrap:wrap;font-size:.9rem;color:#475569;margin:.35rem 0}
.meta .tag{background:#f1f5f9;border:1px solid #e2e8f0;border-radius:999px;padding:.05rem .45rem}
.badge-year{margin-left:.25rem;background:#eef2f7;border:1px solid #d9e2ec;color:#0a4c84;padding:.05rem .45rem;border-radius:999px;font-weight:600}
.actions{display:flex;gap:.5rem;flex-wrap:wrap;margin-top:.6rem}
.btn{display:inline-flex;align-items:center;gap:.35rem;border:1px solid #d9e2ec;background:#eef2f7;color:#0a4c84;border-radius:10px;padding:.45rem .65rem;text-decoration:none}
.btn.primary{background:var(--c1);border-color:transparent;color:#fff}
.empty{color:#667085;text-align:center;margin:1.2rem 0}
</style>
</head>
<body>
<div class="container">

  <!-- Cabecera con logo + título (ruta a /img desde aquí: ../../img/...) -->
  <div class="hero-top">
    <img src="../../images/sesiones.png" alt="Sesiones clínicas" />
    <h1><i class="fa-regular fa-calendar"></i> Sesiones clínicas · Histórico</h1>
  </div>

  <!-- Buscador y filtros -->
  <div class="toolbar">
    <input id="buscador" type="search" placeholder="Buscar por título, autor o tema…" autocomplete="off">
    <div id="filtros" class="filters"></div>
  </div>
  <p class="note">Repositorio interno con fines docentes. Verifica versiones oficiales y vigentes.</p>

  <!-- Tarjetas -->
  <div id="grid" class="card-grid"></div>
  <div id="vacio" class="empty" style="display:none">No hay resultados con los filtros/búsqueda.</div>
</div>

<script>
// ===== Configuración: lista de años a cargar =====
const YEARS = ["hasta-2019","2020","2021","2022","2023","2024","2025"];

// ===== Registro global (lo usan los data.js de cada año) =====
const ALL = [];
window.registerSessions = function(year, arr){
  (arr||[]).forEach(s => {
    // normalizamos campos y añadimos el año
    s.year = year;
    s.title = s.title || "";
    s.author = s.author || "";
    s.date = s.date || "";
    s.tags = s.tags || [];
    // hacemos las rutas absolutas respecto a este index global
    if (s.pdf && !s.pdf.startsWith("http"))  s.pdf  = `${year}/${s.pdf}`;
    if (s.pptx && !s.pptx.startsWith("http")) s.pptx = `${year}/${s.pptx}`;
  });
  ALL.push(...arr);
  render();
};

// ===== Carga dinámica de los data.js de cada año =====
function loadYear(year){
  const s = document.createElement('script');
  s.src = `${encodeURIComponent(year)}/data.js`;
  s.onerror = () => console.warn(`No se pudo cargar ${year}/data.js (¿vacío aún?)`);
  document.head.appendChild(s);
}
YEARS.forEach(loadYear);

// ===== UI: buscador y chips de año =====
const grid   = document.getElementById('grid');
const empty  = document.getElementById('vacio');
const input  = document.getElementById('buscador');
const chipsC = document.getElementById('filtros');

let activeYear = "Todos";

function buildChips(){
  chipsC.innerHTML = "";
  const allChip = chip("Todos", activeYear==="Todos");
  chipsC.appendChild(allChip);
  YEARS.forEach(y=>{
    chipsC.appendChild(chip(y, activeYear===y));
  });
}
function chip(label,active){
  const el = document.createElement('button');
  el.className = 'chip' + (active ? ' active' : '');
  el.textContent = label;
  el.addEventListener('click', ()=>{
    activeYear = label;
    buildChips();
    render();
  });
  return el;
}
buildChips();

// ===== Render y búsqueda =====
function matchesQuery(s, q){
  if(!q) return true;
  const hay = (s.title+' '+s.author+' '+(s.tags||[]).join(' ')).toLowerCase();
  return hay.includes(q);
}
function byDateDesc(a,b){
  // ordena por fecha desc; si no hay fecha, empuja al final
  const da = a.date || "";
  const db = b.date || "";
  return db.localeCompare(da) || (b.title.localeCompare(a.title));
}
function render(){
  const q = (input.value||"").toLowerCase().trim();
  let list = [...ALL];
  if (activeYear !== "Todos") list = list.filter(s => s.year === activeYear);
  list = list.filter(s => matchesQuery(s, q)).sort(byDateDesc);

  grid.innerHTML = list.map(cardHTML).join('');
  empty.style.display = list.length ? 'none' : 'block';
}
function cardHTML(s){
  const tags = (s.tags||[]).map(t=>`<span class="tag">${t}</span>`).join('');
  const pdfBtn = s.pdf  ? `<a class="btn primary" href="${s.pdf}" target="_blank" rel="noopener"><i class="fa-solid fa-file-pdf"></i> PDF</a>` : '';
  const pptBtn = s.pptx ? `<a class="btn" href="${s.pptx}" target="_blank" rel="noopener"><i class="fa-solid fa-file-powerpoint"></i> PPTX</a>` : '';

  return `
    <article class="link-card">
      <h3 class="title">${s.title} <span class="badge-year">${s.year}</span></h3>
      <div class="meta">
        <span>Autor/a: ${s.author || '—'}</span>
        <span>· Fecha: ${s.date || '—'}</span>
      </div>
      <div class="meta">${tags}</div>
      <div class="actions">${pdfBtn}${pptBtn}
        <a class="btn" href="${encodeURIComponent(s.year)}/index.html" target="_blank" rel="noopener">
          <i class="fa-solid fa-up-right-from-square"></i> Ver año
        </a>
      </div>
    </article>
  `;
}
input.addEventListener('input', render);
</script>
</body>
</html>
