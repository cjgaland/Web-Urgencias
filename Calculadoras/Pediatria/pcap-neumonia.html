<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>NAC pediátrica (PCAP orientativo)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
:root{--c1:#0a5ea8;--c1d:#0a4c84;--bd:#e1eefc;--bg:#f7fbff;--bx:#d1d9e6;--tx:#0a4c84;--mut:#667085}
body{font-family:Roboto,Arial,sans-serif;margin:0;padding:20px}
.card{max-width:900px;margin:auto;background:#fff;border:1px solid #e5e7eb;border-radius:12px;box-shadow:0 4px 16px rgba(0,0,0,.05);padding:16px}
h1{font-size:1.25rem;margin:.25rem 0 1rem;color:var(--tx)}
fieldset{border:1px solid #e5e7eb;border-radius:12px;padding:.8rem;margin-bottom:.9rem}
legend{padding:0 .4rem;color:#334155;font-weight:700}
label{display:flex;align-items:center;gap:.6rem;margin:.2rem 0}
input[type=checkbox]{transform:scale(1.1)}
.small{font-size:.9rem;color:var(--mut)}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:.6rem}
select,input{border:1px solid var(--bx);border-radius:10px;padding:.55rem}
.actions{display:flex;gap:.6rem;margin-top:.9rem;flex-wrap:wrap;align-items:center}
.btn{padding:.6rem .9rem;border-radius:10px;border:1px solid transparent;cursor:pointer;font-weight:500}
.btn.primary{background:var(--c1);color:#fff}.btn.primary:hover{background:var(--c1d)}
.btn.secondary{background:#eef2f7;color:var(--tx);border-color:#d9e2ec}
.result{margin-top:1rem;padding:.9rem;border:1px solid var(--bd);background:var(--bg);border-radius:10px;white-space:pre-wrap;color:var(--tx)}
.badge{display:inline-block;padding:.2rem .5rem;border-radius:999px;font-weight:600}
.low{background:#ecfdf5;color:#065f46;border:1px solid #a7f3d0}
.mod{background:#fff7ed;color:#9a3412;border:1px solid #fed7aa}
.high{background:#fef2f2;color:#991b1b;border:1px solid #fecaca}
@media(max-width:860px){.grid{grid-template-columns:1fr}}

*{box-sizing:border-box}
select{max-width:100%}
.actions .spacer{flex:1 1 auto}
.btn.close{margin-left:auto;background:#08406a;color:#fff;border-color:#083554}
.btn.close:hover{filter:brightness(1.05)}</style>
</head>
<body>
<div class="card">
  <h1>NAC pediátrica (PCAP orientativo)</h1>
  <p class="small">
    Herramienta orientativa basada en criterios clínicos habituales (inspirada en PIDS–IDSA) para estratificar la gravedad de la NAC pediátrica.
    Ajusta los criterios a tu protocolo si procede. El resultado <em>no sustituye</em> el juicio clínico.
  </p>

  <form id="f">
    <fieldset>
      <legend>Constantes / Oxigenación</legend>
      <label><input type="checkbox" id="spo2ra"> SpO₂ &lt; 90% en aire ambiente (o &lt;92% si enfermedad subyacente)</label>
      <label><input type="checkbox" id="respDistress"> Dificultad respiratoria moderada-severa (quejido, tiraje, aleteo)</label>
      <label><input type="checkbox" id="apnea"> Apneas / cianosis / pausas</label>
      <label><input type="checkbox" id="rrHigh"> Taquipnea marcada para la edad</label>
    </fieldset>

    <fieldset>
      <legend>Estado general / Ingesta</legend>
      <label><input type="checkbox" id="toxic"> Mal estado general / aspecto tóxico</label>
      <label><input type="checkbox" id="oralPoor"> Ingesta oral insuficiente / deshidratación</label>
      <label><input type="checkbox" id="vomits"> Vómitos persistentes</label>
      <label><input type="checkbox" id="altMental"> Alteración del estado mental</label>
    </fieldset>

    <fieldset>
      <legend>Riesgo / Comorbilidad</legend>
      <label><input type="checkbox" id="prematurity"> Prematuridad &lt; 37 sem o &lt;3 meses de edad</label>
      <label><input type="checkbox" id="cardioPulm"> Cardiopatía / neumopatía crónica / neuromuscular</label>
      <label><input type="checkbox" id="immuno"> Inmunodeficiencia / corticoterapia sistémica</label>
    </fieldset>

    <fieldset>
      <legend>Exploración / Analítica (opcionales)</legend>
      <label><input type="checkbox" id="dehydration"> Signos de deshidratación moderada-severa</label>
      <label><input type="checkbox" id="retractions"> Retracciones costales marcadas</label>
      <label><input type="checkbox" id="hypotension"> Hipotensión para edad</label>
      <label><input type="checkbox" id="abnormalCxr"> Rx con consolidación extensa / derrame / multilobar</label>
    </fieldset>

    <fieldset>
      <legend>Datos de contexto</legend>
      <div class="grid">
        <label>Edad
          <select id="ageBand">
            <option value="lt3m">&lt; 3 meses</option>
            <option value="3to12m">3–12 meses</option>
            <option value="1to5y" selected>1–5 años</option>
            <option value="gt5y">&gt; 5 años</option>
          </select>
        </label>
        <label>FC (lpm) <input type="number" id="hr" min="0" step="1" placeholder="opcional"></label>
        <label>FR (rpm) <input type="number" id="rr" min="0" step="1" placeholder="opcional"></label>
        <label>SpO₂ (%) <input type="number" id="spo2" min="0" max="100" step="1" placeholder="opcional"></label>
      </div>
      <p class="small">Si no rellenas constantes, el cálculo se basa solo en los criterios cualitativos marcados.</p>
    </fieldset>

    <div class="actions">
      <button type="button" class="btn primary" onclick="calc()">Calcular</button>
      <button type="button" class="btn secondary" onclick="copyRes()">Copiar</button>
      <button type="reset" class="btn secondary">Limpiar</button>
    
      <span class="spacer"></span>
      <button type="button" id="closeBtn" class="btn close" title="Cerrar esta ventana">Cerrar ventana</button>
</div>
  </form>

  <div id="res" class="result" aria-live="polite">Marca criterios y pulsa Calcular.</div>
    <p class="muted"><strong>Nota clínica:</strong> La estratificación orienta el nivel de cuidados. Integrar constantes, oxigenación e imagen. Decisión de antibiótico e ingreso individualizada según guías locales.</p>

</div>

<script>
function any(ids){return ids.some(id=>document.getElementById(id).checked)}
function count(ids){return ids.reduce((a,id)=>a+(document.getElementById(id).checked?1:0),0)}
function calc(){
  const major = any(['spo2ra','respDistress','apnea','hypotension','altMental']);
  const minorCount = count(['rrHigh','toxic','oralPoor','vomits','dehydration','retractions','abnormalCxr']);
  const risk = count(['prematurity','cardioPulm','immuno']);

  // Regla orientativa (ajustable):
  // Grave: cualquier "major" o ≥3 menores o SpO2 documentada < 90
  // Moderada: 1–2 menores o comorbilidad relevante
  // Leve: sin criterios
  let cat='LEVE', badge='low', reco='Manejo ambulatorio con seguimiento.';
  if(major || minorCount>=3){
    cat='GRAVE'; badge='high'; reco='Ingreso. Oxigenoterapia/soporte según necesidad. Antibiótico IV si indicado.';
  }else if(minorCount>=1 || risk>=1){
    cat='MODERADA'; badge='mod'; reco='Observación/ingreso corto según evolución. Antibiótico según guía, reevaluación.';
  }

  const hr = document.getElementById('hr').value;
  const rr = document.getElementById('rr').value;
  const spo2 = document.getElementById('spo2').value;
  const age = document.getElementById('ageBand').value;

  const lines = [
    `Resultado: ${cat}`,
    `Sugerencia: ${reco}`,
    '',
    `Detalles marcados:`,
    `- Mayores: ${major?'sí':'no'}`,
    `- Menores: ${minorCount}`,
    `- Riesgo/comorbilidad: ${risk}`,
    `- Constantes (opcionales): FC ${hr||'–'} | FR ${rr||'–'} | SpO₂ ${spo2||'–'}% | Edad ${age}`
  ].join('\n');

  document.getElementById('res').innerHTML =
    `Severidad NAC pediátrica = <strong>${cat}</strong> `+
    `<span class="badge ${badge}">${cat}</span>\n`+lines;
}
function copyRes(){
  const t=document.getElementById('res').innerText||'';
  if(!t.trim()) return alert('No hay resultado.');
  navigator.clipboard.writeText(t);
}

// Cierre inteligente
function smartClose(){
  try{
    if(window.opener && !window.opener.closed){ window.close(); return; }
  }catch(e){}
  if(history.length>1){ history.back(); }
  else{ location.href='../index.html'; } // Ajusta si tu índice está en otra ruta
}
var _cb = document.getElementById('closeBtn');
if(_cb){ _cb.addEventListener('click', smartClose); }

</script>
</body>
</html>
