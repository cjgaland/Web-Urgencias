<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>PECARN TCE &lt; 2 años</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
:root{--c1:#0a5ea8;--c1d:#0a4c84;--bd:#e1eefc;--bg:#f7fbff;--bx:#d1d9e6;--tx:#0a4c84}
body{font-family:Roboto,Arial,sans-serif;margin:0;padding:20px}
.card{max-width:880px;margin:auto;background:#fff;border:1px solid #e5e7eb;border-radius:12px;box-shadow:0 4px 16px rgba(0,0,0,.05);padding:16px}
h1{font-size:1.25rem;margin:.25rem 0 1rem;color:var(--tx)}
.small{font-size:.9rem;color:#475569}
fieldset{border:1px solid #e5e7eb;border-radius:12px;padding:.8rem;margin-bottom:.9rem}
legend{padding:0 .4rem;color:#334155;font-weight:700}
label{display:flex;align-items:center;gap:.6rem;margin:.2rem 0}
input[type=checkbox]{transform:scale(1.15)}
.actions{display:flex;gap:.6rem;margin-top:.9rem;flex-wrap:wrap;align-items:center}
.btn{padding:.6rem .9rem;border-radius:10px;border:1px solid transparent;cursor:pointer;font-weight:500}
.btn.primary{background:var(--c1);color:#fff}.btn.primary:hover{background:var(--c1d)}
.btn.secondary{background:#eef2f7;color:var(--tx);border-color:#d9e2ec}
.result{margin-top:1rem;padding:.9rem;border:1px solid var(--bd);background:var(--bg);border-radius:10px;white-space:pre-wrap;color:var(--tx)}
.note{color:#065f46;background:#ecfdf5;border:1px solid #a7f3d0;border-radius:8px;padding:.5rem .7rem;margin-top:.6rem}
.warn{color:#9a3412;background:#fff7ed;border:1px solid #fed7aa;border-radius:8px;padding:.5rem .7rem;margin-top:.6rem}

*{box-sizing:border-box}
select{max-width:100%}
.actions .spacer{flex:1 1 auto}
.btn.close{margin-left:auto;background:#08406a;color:#fff;border-color:#083554}
.btn.close:hover{filter:brightness(1.05)}</style>
</head>
<body>
<div class="card">
  <h1>PECARN TCE &lt; 2 años</h1>
  <p class="small">
    Regla de decisión para TCE pediátrico &lt;2 años. Clasifica en <em>alto</em>, <em>intermedio</em> o <em>bajo</em> riesgo de lesión cerebral clínicamente importante.
    Uso orientativo; integra siempre el juicio clínico y protocolos locales.
  </p>

  <form id="f">
    <fieldset>
      <legend>Predictores de <strong>alto riesgo</strong></legend>
      <label><input type="checkbox" id="gcs"> GCS &lt; 15</label>
      <label><input type="checkbox" id="palpFrac"> Fractura de cráneo palpable</label>
      <label><input type="checkbox" id="ams"> Alteración del estado mental (irritabilidad marcada, somnolencia, respuesta anormal)</label>
    </fieldset>

    <fieldset>
      <legend>Predictores de <strong>riesgo intermedio</strong></legend>
      <label><input type="checkbox" id="nonFrontalHematoma"> Hematoma del cuero cabelludo no frontal</label>
      <label><input type="checkbox" id="loc"> Pérdida de conciencia ≥ 5 s (según testigo)</label>
      <label><input type="checkbox" id="sevMech"> Mecanismo de alta energía (p. ej. atropello, caída &gt;0.9–1 m, impacto objeto alto)</label>
      <label><input type="checkbox" id="notActing"> “No actúa como siempre” (referido por cuidadores)</label>
    </fieldset>

    <fieldset>
      <legend>Datos adicionales (opcionales)</legend>
      <label style="gap:.4rem">Tiempo desde el evento (h): <input type="number" id="hours" min="0" step="0.5" style="width:120px"></label>
      <label style="gap:.4rem">Vómitos: <input type="number" id="vom" min="0" step="1" style="width:120px" placeholder="nº episodios"></label>
    </fieldset>

    <div class="actions">
      <button type="button" class="btn primary" onclick="calc()">Calcular</button>
      <button type="button" class="btn secondary" onclick="copyRes()">Copiar</button>
      <button type="reset" class="btn secondary">Limpiar</button>
    
      <span class="spacer"></span>
      <button type="button" id="closeBtn" class="btn close" title="Cerrar esta ventana">Cerrar ventana</button>
</div>
  </form>

  <div id="res" class="result" aria-live="polite">Marca los predictores y pulsa Calcular.</div>
    <p class="muted"><strong>Nota clínica:</strong> PECARN &lt;2 años. Predictores de alto/intermedio riesgo tienen pesos distintos a ≥2 años. La decisión TC/observación debe individualizarse (edad, síntomas, evolución). No sustituye la valoración clínica.</p>

  <div id="note" class="note" style="display:none"></div>
  <div id="warn" class="warn" style="display:none"></div>
</div>

<script>
function txt(b){return b?'Sí':'No'}
function calc(){
  const gcs = document.getElementById('gcs').checked;
  const palp = document.getElementById('palpFrac').checked;
  const ams = document.getElementById('ams').checked;

  const nonFr = document.getElementById('nonFrontalHematoma').checked;
  const loc = document.getElementById('loc').checked;
  const sev = document.getElementById('sevMech').checked;
  const notAct = document.getElementById('notActing').checked;

  const vom = parseInt(document.getElementById('vom').value||'0',10);
  const hours = parseFloat(document.getElementById('hours').value||'');
  const res = document.getElementById('res');
  const note = document.getElementById('note');
  const warn = document.getElementById('warn');
  note.style.display='none'; warn.style.display='none'; note.textContent=''; warn.textContent='';

  let risk = 'BAJO';
  let reco = 'Observación clínica. No TC de rutina.';
  if (gcs || palp || ams){
    risk = 'ALTO';
    reco = 'Recomendar TC craneal inmediata (o traslado según protocolo).';
  } else if (nonFr || loc || sev || notAct){
    risk = 'INTERMEDIO';
    reco = 'Observación clínica estrecha vs TC según evolución/otros factores (edad, empeoramiento, múltiples predictores).';
  }

  res.textContent =
`PECARN &lt;2 a
— Alto riesgo:
   • GCS<15: ${txt(gcs)}
   • Fractura palpable: ${txt(palp)}
   • AMS: ${txt(ams)}
— Intermedio:
   • Hematoma no frontal: ${txt(nonFr)}
   • LOC ≥5 s: ${txt(loc)}
   • Mecanismo severo: ${txt(sev)}
   • No actúa como siempre: ${txt(notAct)}
— Datos: vómitos ${isFinite(vom)?vom:'–'} | horas desde evento ${isFinite(hours)?hours:'–'}

Resultado: Riesgo ${risk}.
Conducta: ${reco}`;

  if (risk==='INTERMEDIO' && (vom>=2 || (isFinite(hours) && hours<2))){
    note.style.display='block';
    note.textContent='Nota: vómitos repetidos o evaluación muy precoz pueden inclinar hacia TC o prolongar observación.';
  }
}
function copyRes(){
  const t=document.getElementById('res').textContent||'';
  if(!t.trim()) return alert('No hay resultado.');
  navigator.clipboard.writeText(t);
}

// Cierre inteligente
function smartClose(){
  try{
    if(window.opener && !window.opener.closed){ window.close(); return; }
  }catch(e){}
  if(history.length>1){ history.back(); }
  else{ location.href='../index.html'; } // Ajusta si tu índice está en otra ruta
}
var _cb = document.getElementById('closeBtn');
if(_cb){ _cb.addEventListener('click', smartClose); }

</script>
</body>
</html>
