<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>ABCD² – Riesgo tras AIT</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
:root{--c1:#0a5ea8;--c1d:#0a4c84;--bd:#e1eefc;--bg:#f7fbff;--bx:#d1d9e6;--tx:#0a4c84;--mut:#667085}
body{font-family:Roboto,Arial,sans-serif;margin:0;padding:20px;background:#fff;color:#222}
.card{max-width:900px;margin:auto;background:#fff;border:1px solid #e5e7eb;border-radius:12px;box-shadow:0 4px 16px rgba(0,0,0,.05);padding:16px}
h1{font-size:1.25rem;margin:.25rem 0 1rem;color:var(--tx)}
.small{font-size:.9rem;color:var(--mut)}
fieldset{border:1px solid #e5e7eb;border-radius:12px;padding:.8rem;margin-bottom:.9rem}
legend{padding:0 .4rem;color:#334155;font-weight:700}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:.7rem}
label{display:flex;gap:.55rem;align-items:center;margin:.25rem 0}
input[type=checkbox]{transform:scale(1.1)}
.note{font-size:.85rem;color:#475569;margin:.25rem 0}
.actions{display:flex;gap:.6rem;margin-top:.9rem;flex-wrap:wrap;align-items:center}
.btn{padding:.6rem .9rem;border-radius:10px;border:1px solid transparent;cursor:pointer;font-weight:500}
.btn.primary{background:var(--c1);color:#fff}.btn.primary:hover{background:var(--c1d)}
.btn.secondary{background:#eef2f7;color:var(--tx);border-color:#d9e2ec}
.result{margin-top:1rem;padding:.9rem;border:1px solid var(--bd);background:var(--bg);border-radius:10px;white-space:pre-wrap;color:var(--tx)}
.badge{display:inline-block;padding:.2rem .5rem;border-radius:999px;font-weight:600}
.low{background:#ecfdf5;color:#065f46;border:1px solid #a7f3d0}
.mod{background:#fff7ed;color:#9a3412;border:1px solid #fed7aa}
.high{background:#fef2f2;color:#991b1b;border:1px solid #fecaca}
@media(max-width:860px){.grid{grid-template-columns:1fr}}

*{box-sizing:border-box}
select{max-width:100%}
.actions .spacer{flex:1 1 auto}
.btn.close{margin-left:auto;background:#08406a;color:#fff;border-color:#083554}
.btn.close:hover{filter:brightness(1.05)}</style>
</head>
<body>
<div class="card">
  <h1>ABCD² – Riesgo de ictus tras AIT</h1>
  <p class="small">
    Suma de 0 a 7 puntos. Interpretación orientativa (0–3 bajo, 4–5 intermedio, 6–7 alto). No sustituye el juicio clínico ni las guías locales.
  </p>

  <form id="f">
    <fieldset>
      <legend>Criterios ABCD²</legend>

      <div class="grid">
        <div>
          <strong>A – Age</strong>
          <label><input type="checkbox" id="age60"> Edad ≥ 60 años (1)</label>
          <div class="note">Si no se marca, puntúa 0.</div>
        </div>

        <div>
          <strong>B – Blood Pressure</strong>
          <label><input type="checkbox" id="bpHigh"> PA inicial ≥ 140/90 mmHg (1)</label>
          <div class="note">Medida al llegar (o la primera disponible).</div>
        </div>

        <div>
          <strong>C – Clinical features</strong>
          <label><input type="checkbox" id="weakness"> Déficit motor unilateral (2)</label>
          <label><input type="checkbox" id="speechOnly"> Trastorno del habla sin debilidad (1)</label>
          <div class="note">Si hay debilidad, marca solo “Déficit motor” (2) y no “Habla”.</div>
        </div>

        <div>
          <strong>D – Duration</strong>
          <label><input type="checkbox" id="dur60"> Duración ≥ 60 min (2)</label>
          <label><input type="checkbox" id="dur10"> Duración 10–59 min (1)</label>
          <div class="note">Si marcaste ≥60 min (2), no marques 10–59 (1).</div>
        </div>

        <div>
          <strong>D – Diabetes</strong>
          <label><input type="checkbox" id="dm"> Diabetes (1)</label>
        </div>
      </div>
    </fieldset>

    <div class="actions">
      <button type="button" class="btn primary" onclick="calc()">Calcular</button>
      <button type="button" class="btn secondary" onclick="copyRes()">Copiar</button>
      <button type="reset"  class="btn secondary" onclick="resetRes()">Limpiar</button>
    
      <span class="spacer"></span>
      <button type="button" id="closeBtn" class="btn close" title="Cerrar esta ventana">Cerrar ventana</button>
</div>
  </form>

  <div id="res" class="result" aria-live="polite">Marca los criterios y pulsa Calcular.</div>
    <p class="muted"><strong>Nota clínica:</strong> Puntuaciones más altas se asocian a mayor riesgo de ictus precoz tras AIT. Interpretación orientativa (0–3 bajo, 4–5 intermedio, 6–7 alto). Ajusta manejo a protocolos locales y disponibilidad de TIA clinic.</p>

</div>

<script>
function calc(){
  // Reglas de exclusión interna para evitar doble conteo:
  const age60   = document.getElementById('age60').checked ? 1 : 0;
  const bpHigh  = document.getElementById('bpHigh').checked ? 1 : 0;

  const weakness    = document.getElementById('weakness').checked;     // 2 puntos si sí
  const speechOnly  = (!weakness && document.getElementById('speechOnly').checked) ? 1 : 0; // solo si no hay weakness
  const clin        = weakness ? 2 : speechOnly; // 0 si ninguno

  const dur60  = document.getElementById('dur60').checked ? 2 : 0;
  const dur10  = (!dur60 && document.getElementById('dur10').checked) ? 1 : 0;
  const dur    = dur60 || dur10; // 2 o 1 o 0

  const dm     = document.getElementById('dm').checked ? 1 : 0;

  const total = age60 + bpHigh + clin + (dur60?2:dur10) + dm;

  // Categoría y sugerencias orientativas:
  let cat = {txt:'Bajo riesgo', badge:'low'};
  let sug = 'Alta con observación estrecha y estudio preferente; educación sobre signos de alarma.';
  if(total >= 6){
    cat = {txt:'Alto riesgo', badge:'high'};
    sug = 'Considerar ingreso / estudio urgente (neuroimagen, etiología, inicio secundario).';
  } else if(total >= 4){
    cat = {txt:'Riesgo intermedio', badge:'mod'};
    sug = 'Observación y estudio rápido (TIA clinic/urgencias) según recursos locales.';
  }

  // Texto clínico:
  const desgl = [
    `Edad≥60: ${age60}`,
    `PA≥140/90: ${bpHigh}`,
    `Clínica (motor=2 / habla=1): ${clin}`,
    `Duración (≥60=2 / 10–59=1): ${dur60?2:(dur10?1:0)}`,
    `Diabetes: ${dm}`
  ].join(' · ');

  document.getElementById('res').innerHTML =
    `ABCD² = <strong>${total}</strong> → `+
    `<span class="badge ${cat.badge}">${cat.txt}</span>\n`+
    `Sugerencia: ${sug}\n`+
    `Desglose: ${desgl}`;
}

function copyRes(){
  const t = document.getElementById('res').innerText || '';
  if(!t.trim()) return alert('No hay resultado.');
  navigator.clipboard.writeText(t);
}

function resetRes(){
  document.getElementById('res').textContent = 'Marca los criterios y pulsa Calcular.';
}

// Cierre inteligente
function smartClose(){
  try{
    if(window.opener && !window.opener.closed){ window.close(); return; }
  }catch(e){}
  if(history.length>1){ history.back(); }
  else{ location.href='../index.html'; } // Ajusta si tu índice está en otra ruta
}
var _cb = document.getElementById('closeBtn');
if(_cb){ _cb.addEventListener('click', smartClose); }

</script>
</body>
</html>
