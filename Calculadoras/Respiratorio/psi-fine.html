<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>FINE / PSI – Neumonía adquirida en la comunidad</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
:root{--c1:#0a5ea8;--c1-600:#0a4c84;--bd:#e1eefc;--bg:#f7fbff;--bx:#d1d9e6;--tx:#0a4c84;--mut:#667085}
body{font-family:Roboto,Arial,Helvetica,sans-serif;margin:0;padding:20px;background:#fff;color:#222}
h1{font-size:1.25rem;margin:.25rem 0 1rem;color:var(--tx)}
.card{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:16px;max-width:860px;margin:0 auto;box-shadow:0 4px 16px rgba(0,0,0,.05)}
fieldset{border:1px solid #e5e7eb;border-radius:10px;margin:.6rem 0;padding:.6rem .9rem}
legend{padding:0 .4rem;color:#334155;font-weight:600}
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:.7rem}
.grid3{display:grid;grid-template-columns:repeat(3,1fr);gap:.7rem}
label{display:flex;gap:.5rem;align-items:center}
input[type=number]{width:100%;padding:.5rem;border:1px solid var(--bx);border-radius:10px}
select{padding:.5rem;border:1px solid var(--bx);border-radius:10px}
input[type=checkbox]{transform:translateY(2px)}
.small{font-size:.9rem;color:#475569}
.actions{display:flex;gap:.6rem;margin-top:.7rem;flex-wrap:wrap}
.btn{padding:.6rem .9rem;border-radius:10px;border:1px solid transparent;cursor:pointer;font-weight:500}
.btn.primary{background:var(--c1);color:#fff}.btn.primary:hover{background:var(--c1-600)}
.btn.secondary{background:#eef2f7;color:var(--tx);border-color:#d9e2ec}.btn.secondary:hover{background:#e6ebf2}
.result{margin-top:1rem;padding:.9rem;border:1px solid var(--bd);background:var(--bg);border-radius:10px;white-space:pre-wrap;color:#0a4c84}
.muted{color:var(--mut);font-size:.9rem}
@media(max-width:720px){.grid2,.grid3{grid-template-columns:1fr}}

*{box-sizing:border-box}
select{max-width:100%}
.actions .spacer{flex:1 1 auto}
.btn.close{margin-left:auto;background:#08406a;color:#fff;border-color:#083554}
.btn.close:hover{filter:brightness(1.05)}</style>
</head>
<body>
<div class="card">
  <h1>FINE / PSI (Pneumonia Severity Index)</h1>
  <p class="small">Calcula la puntuación PSI para estratificación de riesgo en neumonía adquirida en la comunidad (NAC).</p>

  <form id="formPSI">
    <fieldset>
      <legend>Datos básicos</legend>
      <div class="grid3">
        <label>Edad (años)
          <input type="number" id="age" min="0" step="1" placeholder="Ej. 72" required>
        </label>
        <label>Sexo
          <select id="sex">
            <option value="M">Varón</option>
            <option value="F">Mujer</option>
          </select>
        </label>
        <label>Residencia sociosanitaria (Vivienda tutelada / residencia)
          <input type="checkbox" id="nursing">
        </label>
      </div>
      <p class="small">Base de puntos: varón = edad; mujer = edad − 10.</p>
    </fieldset>

    <fieldset>
      <legend>Comorbilidades</legend>
      <div class="grid3">
        <label><input type="checkbox" id="neoplastic"> Neoplasia activa ( +30 )</label>
        <label><input type="checkbox" id="liver"> Enfermedad hepática ( +20 )</label>
        <label><input type="checkbox" id="chf"> Insuficiencia cardiaca ( +10 )</label>
        <label><input type="checkbox" id="cva"> Enfermedad cerebrovascular ( +10 )</label>
        <label><input type="checkbox" id="renal"> Enfermedad renal ( +10 )</label>
      </div>
    </fieldset>

    <fieldset>
      <legend>Exploración y constantes</legend>
      <div class="grid3">
        <label><input type="checkbox" id="confusion"> Alteración mental ( +20 )</label>
        <label>FR ≥ 30 /min
          <input type="checkbox" id="rr30">
        </label>
        <label>PAS &lt; 90 mmHg
          <input type="checkbox" id="sbp90">
        </label>
        <label>Temperatura &lt; 35°C <u>o</u> ≥ 40°C
          <input type="checkbox" id="tempFlag">
        </label>
        <label>FC ≥ 125 lpm
          <input type="checkbox" id="hr125">
        </label>
      </div>
    </fieldset>

    <fieldset>
      <legend>Analítica / Gasometría / Rx</legend>
      <div class="grid2">
        <label>pH &lt; 7.35 <input type="checkbox" id="phLow"></label>
        <label>BUN/Urea ≥ 30 mg/dL <input type="checkbox" id="bun30"></label>
        <label>Na⁺ &lt; 130 mEq/L <input type="checkbox" id="naLow"></label>
        <label>Glucosa ≥ 250 mg/dL <input type="checkbox" id="glu250"></label>
        <label>Hematocrito &lt; 30% <input type="checkbox" id="hctLow"></label>
        <label>PaO₂ &lt; 60 mmHg <em>o</em> SatO₂ &lt; 90% <input type="checkbox" id="o2Low"></label>
        <label>Derrame pleural en Rx <input type="checkbox" id="effusion"></label>
      </div>
      <p class="small">Puntos: pH ( +30 ), BUN ( +20 ), Na ( +20 ), Glucosa ( +10 ), Hto ( +10 ), O₂ bajo ( +10 ), Derrame ( +10 ).</p>
    </fieldset>

    <div class="actions">
      <button type="submit" class="btn primary">Calcular</button>
      <button type="button" class="btn secondary" id="copyBtn">Copiar</button>
      <button type="reset" class="btn secondary">Limpiar</button>
    
  <span class="spacer"></span>
  <button type="button" id="closeBtn" class="btn close" title="Cerrar esta ventana">Cerrar ventana</button>
</div>

    <div id="result" class="result" aria-live="polite">Rellena los campos y pulsa “Calcular”.</div>
    <p class="muted"><strong>Nota clínica:</strong> PSI estratifica mortalidad en NAC; clases más altas implican mayor riesgo. La decisión terapéutica (alta, ingreso, UCI) debe integrar la situación clínica y criterios de severidad.</p>

    <p class="muted">Clases PSI: II ≤70, III 71–90, IV 91–130, V ≥131. (Clase I requiere reglas PORT específicas; si no hay predictores adversos y el puntaje sería muy bajo, puede considerarse riesgo muy bajo).</p>
  </form>
</div>

<script>
(function(){
  const $=id=>document.getElementById(id);
  const add = (cond, pts)=> cond ? pts : 0;

  function compute(){
    const age = parseInt($('age').value||'0',10);
    const sex = $('sex').value;
    let score = (sex==='M') ? age : Math.max(0, age - 10);
    score += add($('nursing').checked, 10);

    // Comorbilidades
    score += add($('neoplastic').checked, 30);
    score += add($('liver').checked, 20);
    score += add($('chf').checked, 10);
    score += add($('cva').checked, 10);
    score += add($('renal').checked, 10);

    // Exploración
    score += add($('confusion').checked, 20);
    score += add($('rr30').checked, 20);
    score += add($('sbp90').checked, 20);
    score += add($('tempFlag').checked, 15);
    score += add($('hr125').checked, 10);

    // Analítica/Rx
    score += add($('phLow').checked, 30);
    score += add($('bun30').checked, 20);
    score += add($('naLow').checked, 20);
    score += add($('glu250').checked, 10);
    score += add($('hctLow').checked, 10);
    score += add($('o2Low').checked, 10);
    score += add($('effusion').checked, 10);

    return score;
  }

  function klass(s){
    if(s <= 70) return {clase:'II', rec:'Bajo riesgo. Manejo ambulatorio/observación según criterio.'};
    if(s <= 90) return {clase:'III', rec:'Riesgo bajo-intermedio. Considerar ingreso breve/observación.'};
    if(s <= 130) return {clase:'IV', rec:'Riesgo intermedio-alto. Ingreso hospitalario.'};
    return {clase:'V', rec:'Alto riesgo. Valorar UCI/monitorización estrecha.'};
  }

  $('formPSI').addEventListener('submit', (e)=>{
    e.preventDefault();
    const s = compute();
    const k = klass(s);
    $('result').textContent = `PSI (FINE) = ${s}\nClase: ${k.clase}\n${k.rec}`;
  });

  $('copyBtn').addEventListener('click', ()=>{
    const t=$('result').textContent||''; if(!t.trim()) return alert('No hay resultado.');
    navigator.clipboard.writeText(t).then(()=>{
      const b=$('copyBtn'); b.textContent='¡Copiado!'; setTimeout(()=>b.textContent='Copiar',900);
    });
  });
})();

// Cierre inteligente
function smartClose(){
  try{
    if(window.opener && !window.opener.closed){ window.close(); return; }
  }catch(e){}
  if(history.length>1){ history.back(); }
  else{ location.href='../index.html'; }
}
var _cb = document.getElementById('closeBtn');
if(_cb){ _cb.addEventListener('click', smartClose); }

</script>
</body>
</html>
