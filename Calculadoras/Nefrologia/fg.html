<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Filtrado glomerular (FG)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
:root{--c1:#0a5ea8;--c1-600:#0a4c84;--bd:#e1eefc;--bg:#f7fbff;--bx:#d1d9e6;--tx:#0a4c84;--mut:#667085}
body{font-family:Roboto,Arial,sans-serif;margin:0;padding:20px;background:#fff;color:#222}
.card{max-width:860px;margin:auto;background:#fff;border:1px solid #e5e7eb;border-radius:12px;box-shadow:0 4px 16px rgba(0,0,0,.05);padding:16px}
h1{font-size:1.25rem;margin:.25rem 0 1rem;color:var(--tx)}
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:.7rem}
label{display:flex;flex-direction:column;font-weight:600;color:#334155}
input,select{border:1px solid var(--bx);border-radius:10px;padding:.55rem}
.small{font-size:.9rem;color:#475569}
.actions{display:flex;gap:.6rem;margin-top:.8rem;flex-wrap:wrap;align-items:center}
.btn{padding:.6rem .9rem;border-radius:10px;border:1px solid transparent;cursor:pointer;font-weight:500}
.btn.primary{background:var(--c1);color:#fff}.btn.primary:hover{background:var(--c1-600)}
.btn.secondary{background:#eef2f7;color:var(--tx);border-color:#d9e2ec}
.result{margin-top:1rem;padding:.9rem;border:1px solid var(--bd);background:var(--bg);border-radius:10px;white-space:pre-wrap;color:#0a4c84}
@media(max-width:720px){.grid2{grid-template-columns:1fr}}

*{box-sizing:border-box}
select{max-width:100%}
.actions .spacer{flex:1 1 auto}
.btn.close{margin-left:auto;background:#08406a;color:#fff;border-color:#083554}
.btn.close:hover{filter:brightness(1.05)}</style>
</head>
<body>
<div class="card">
  <h1>Filtrado glomerular (FG)</h1>
  <p class="small">Métodos: Cockcroft-Gault (ml/min), MDRD-4 y CKD-EPI 2021 (ml/min/1.73 m²).</p>

  <form id="fgForm">
    <div class="grid2">
      <label>Sexo
        <select id="sex">
          <option value="M">Varón</option>
          <option value="F">Mujer</option>
        </select>
      </label>
      <label>Edad (años)
        <input type="number" id="age" min="0" step="1" required>
      </label>
      <label>Peso (kg)
        <input type="number" id="weight" min="0" step="0.1" required>
      </label>
      <label>Creatinina sérica (mg/dL)
        <input type="number" id="scr" min="0" step="0.01" required>
      </label>
      <label>Raza (CKD-EPI)
        <select id="race">
          <option value="no">Sin ajuste racial (recomendado)</option>
          <option value="black">Afrodescendiente</option>
        </select>
      </label>
      <label>Método
        <select id="method">
          <option value="cg">Cockcroft-Gault</option>
          <option value="mdrd4">MDRD-4</option>
          <option value="ckdepi2021" selected>CKD-EPI 2021</option>
        </select>
      </label>
    </div>

    <div class="actions">
      <button type="submit" class="btn primary">Calcular</button>
      <button type="button" class="btn secondary" id="copyBtn">Copiar</button>
      <button type="reset" class="btn secondary">Limpiar</button>
    
      <span class="spacer"></span>
      <button type="button" id="closeBtn" class="btn close" title="Cerrar esta ventana">Cerrar ventana</button>
</div>

    <div id="res" class="result" aria-live="polite">Completa los datos y pulsa “Calcular”.</div>
    <p class="muted"><strong>Nota clínica:</strong> Interpretar el FG según la fórmula (Cockcroft-Gault, MDRD, CKD-EPI) y la superficie corporal. Ajustar dosis de fármacos según estadio de ERC.</p>

    <p class="small">Nota: Cockcroft-Gault devuelve ml/min (útil para ajuste fármacos). MDRD/CKD-EPI en ml/min/1.73 m².</p>
  </form>
</div>

<script>
(function(){
  const $=id=>document.getElementById(id);
  const r=(v,d=1)=>Math.round((v+Number.EPSILON)*10**d)/10**d;

  function cockcroftGault(sex, age, weight, scr){
    // CG = ((140 - edad) * peso [kg]) / (72 * Scr) ; *0.85 mujeres
    let cg = ((140 - age) * weight) / (72 * scr);
    if(sex==='F') cg *= 0.85;
    return cg; // ml/min
  }

  function mdrd4(sex, age, scr){
    // MDRD-4 (re-expresada IDMS): GFR = 175 * Scr^-1.154 * edad^-0.203 * (0.742 si mujer) * (1.212 si afrodesc.)
    const sexFac = (sex==='F') ? 0.742 : 1;
    const gfr = 175 * Math.pow(scr, -1.154) * Math.pow(age, -0.203) * sexFac;
    return gfr; // ml/min/1.73
  }

  function ckdEpi2021(sex, age, scr, race){
    // CKD-EPI 2021 (creatinina, sin raza) – opción de "afrodescendiente" sólo informativa (no modifica)
    const k = (sex==='F') ? 0.7 : 0.9;
    const a = (sex==='F') ? -0.241 : -0.302;
    const alpha = (scr/k);
    const min = Math.min(alpha,1), max = Math.max(alpha,1);
    let gfr = 142 * Math.pow(min, a) * Math.pow(max, -1.200) * Math.pow(0.9938, age);
    if(sex==='F') gfr *= 1.012;
    return gfr; // ml/min/1.73
  }

  $('fgForm').addEventListener('submit', e=>{
    e.preventDefault();
    const sex=$('sex').value, age=+$('age').value, weight=+$('weight').value, scr=+$('scr').value;
    const method=$('method').value, race=$('race').value;

    if(!(age>0&&weight>0&&scr>0)) return $('res').textContent='Revisa los datos.';
    let out='';
    if(method==='cg'){
      const cg = cockcroftGault(sex, age, weight, scr);
      out = `Cockcroft-Gault: ${r(cg)} ml/min`;
    }else if(method==='mdrd4'){
      const g = mdrd4(sex, age, scr);
      out = `MDRD-4 (IDMS): ${r(g)} ml/min/1.73 m²`;
    }else{
      const g = ckdEpi2021(sex, age, scr, race);
      out = `CKD-EPI 2021: ${r(g)} ml/min/1.73 m²`;
    }
    $('res').textContent = out;
  });

  $('copyBtn').addEventListener('click', ()=>{
    const t=$('res').textContent||''; if(!t.trim()) return alert('No hay resultado.');
    navigator.clipboard.writeText(t);
  });
})();

// Cierre inteligente
function smartClose(){
  try{
    if(window.opener && !window.opener.closed){ window.close(); return; }
  }catch(e){}
  if(history.length>1){ history.back(); }
  else{ location.href='../index.html'; } // Ajusta si tu índice está en otra ruta
}
var _cb = document.getElementById('closeBtn');
if(_cb){ _cb.addEventListener('click', smartClose); }

</script>
</body>
</html>
